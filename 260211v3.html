<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>DRINK STAND</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="DRINK STAND">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>body{font-family:'Zen Maru Gothic',sans-serif;background-color:#fdfbf7;color:#4a4a4a;overflow:hidden;margin:0;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent}.title-screen{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#fdfbf7;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;transition:opacity .5s ease-out}.title-logo{font-size:3rem;font-weight:900;color:#4a4a4a;display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:30px}.title-icon-large{font-size:6rem;color:#ff9a9e;animation:bounce 2s infinite}.mode-select{display:flex;flex-direction:column;gap:15px;width:100%;max-width:300px;align-items:center}.btn-mode{width:100%;padding:12px 0;border-radius:50px;border:none;font-size:1.1rem;font-weight:900;cursor:pointer;transition:all .1s;display:flex;align-items:center;justify-content:center;gap:10px;color:#fff;box-shadow:0 4px 0 rgba(0,0,0,.1)}.btn-mode:active{transform:translateY(4px);box-shadow:none}.btn-super-easy{background:#a29bfe;box-shadow:0 4px 0 #6c5ce7}.btn-easy{background:#2ecc71;box-shadow:0 4px 0 #27ae60}.btn-normal{background:#e67e22;box-shadow:0 4px 0 #d35400}.mode-desc{font-size:.75rem;font-weight:400;opacity:.9}@keyframes bounce{0%,100%,20%,50%,80%{transform:translateY(0)}40%{transform:translateY(-20px)}60%{transform:translateY(-10px)}}.app-wrapper{width:100vw;height:100vh;display:none;flex-direction:column;padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom)}.header{height:60px;background:#fff;color:#4a4a4a;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:900;box-shadow:0 4px 15px rgba(0,0,0,.05);z-index:50;border-bottom:4px solid #f0f0f0;position:relative}.btn-back{position:absolute;left:15px;background:#f1f2f6;border:none;color:#a4b0be;width:36px;height:36px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:16px;box-shadow:0 2px 0 #dcdde1}.btn-back:active{transform:translateY(2px);box-shadow:none}.btn-back:hover{background:#dfe4ea;color:#2f3542}.stage{flex-grow:1;display:flex;position:relative;background:#fdfbf7}.lane{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:20px 10px;position:relative;transition:background .3s;border-right:2px dashed #e0e0e0}.lane:last-child{border-right:none}.lane.cleared{background-color:rgba(209,250,229,.6)}.customer-area{position:relative;width:100%;display:flex;justify-content:center;align-items:center;margin-bottom:20px;height:140px}.customer-avatar{width:120px;height:120px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:60px;background:#fff;border:4px solid #fff;box-shadow:0 8px 20px rgba(0,0,0,.1);z-index:10;color:#555;overflow:hidden;transition:transform .3s}.customer-avatar img{width:100%;height:100%;object-fit:cover}.customer-enter{animation:popIn .5s cubic-bezier(.175,.885,.32,1.275)}.reward-pill{position:absolute;top:0;left:50%;transform:translateX(-50%) translateY(-50%);background:#FF6B6B;color:#fff;padding:2px 10px;border-radius:20px;font-size:12px;font-weight:700;box-shadow:0 2px 4px rgba(0,0,0,.1);z-index:20}.btn-replay{width:36px;height:36px;border-radius:50%;background:#fff;border:2px solid #eee;color:#888;display:flex;align-items:center;justify-content:center;font-size:14px;cursor:pointer;position:absolute;top:10px;right:20px;box-shadow:0 2px 5px rgba(0,0,0,.05)}.btn-replay:hover{color:#FF6B6B;border-color:#FF6B6B}.order-container{width:100%;flex-grow:1;display:flex;flex-direction:row;justify-content:center;align-items:flex-start;gap:6px;padding:0 4px}.order-card{flex:1;background:#fff;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.05);display:flex;flex-direction:column;align-items:center;padding:10px 4px;min-height:160px;border-bottom:3px solid #f0f0f0}.card-label{font-size:10px;color:#aaa;font-weight:700;margin-bottom:5px;text-transform:uppercase}.card-content{flex-grow:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;width:100%}.card-icon{font-size:55px;line-height:1;display:flex;align-items:center;justify-content:center}.card-icon img{width:90px;height:90px;object-fit:contain}.card-text{font-size:13px;font-weight:700;text-align:center;color:#555;line-height:1.2}.action-area{width:100%;display:flex;align-items:center;justify-content:center;gap:10px;margin-top:15px;padding-bottom:20px}.btn-mic{flex-grow:1;max-width:160px;height:60px;border-radius:50px;background:#FF9F43;color:#fff;border:none;font-weight:900;font-size:16px;box-shadow:0 4px 0 #e67e22;display:flex;align-items:center;justify-content:center;gap:8px;cursor:pointer;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none}.btn-mic:active{transform:translateY(4px);box-shadow:0 0 0 #e67e22}#lane0 .btn-mic{background:#ff9a9e;box-shadow:0 4px 0 #e17076}#lane1 .btn-mic{background:#81ecec;box-shadow:0 4px 0 #00cec9;color:#2d3436}.btn-next{width:45px;height:45px;border-radius:50%;background:#fff;border:2px solid #eee;color:#666;display:flex;align-items:center;justify-content:center;font-size:16px;cursor:pointer;box-shadow:0 3px 0 #ddd}.btn-next:active{transform:translateY(3px);box-shadow:none}.listening{animation:pulse 1.5s infinite;background:#ff4757!important;box-shadow:0 4px 0 #c0392b!important;color:#fff!important}@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(255,71,87,.7)}70%{box-shadow:0 0 0 10px rgba(255,71,87,0)}}.clear-stamp{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-15deg) scale(0);border:4px solid #2ecc71;color:#2ecc71;font-size:28px;font-weight:900;padding:8px 16px;border-radius:12px;background:rgba(255,255,255,.95);opacity:0;pointer-events:none;z-index:30;white-space:nowrap;box-shadow:0 4px 15px rgba(0,0,0,.1)}.stamp-animate{animation:stampIn .3s forwards cubic-bezier(.175,.885,.32,1.275)}.earned-popup{position:absolute;top:40%;left:50%;transform:translate(-50%,-50%) scale(0);font-size:3.5rem;font-weight:900;color:#fab1a0;text-shadow:2px 2px 0 #fff,0 0 10px rgba(0,0,0,.1);z-index:40;pointer-events:none;white-space:nowrap;opacity:0}.earned-popup.show{animation:popReward .6s cubic-bezier(.175,.885,.32,1.275) forwards}@keyframes stampIn{to{transform:translate(-50%,-50%) rotate(-15deg) scale(1);opacity:1}}@keyframes popReward{0%{transform:translate(-50%,-50%) scale(0);opacity:0}50%{transform:translate(-50%,-50%) scale(1.2);opacity:1}100%{transform:translate(-50%,-50%) scale(1);opacity:1}}@keyframes popIn{0%{transform:scale(0) translateY(50px);opacity:0}100%{transform:scale(1) translateY(0);opacity:1}}.footer{height:30px;background:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;color:#999;border-top:1px solid #f0f0f0}
/* デバッグログ非表示用 */
#speechLog span, #speechLog b { display: none; }
</style>
</head>
<body>
<audio id="bgm" loop src="material/bgm/cafe_music.mp3"></audio>
<div id="title-screen" class="title-screen">
<div class="title-logo"><div class="title-icon-large"><i class="fa-solid fa-mug-hot"></i></div><div>DRINK STAND</div><div style="font-size:1.2rem;font-weight:400;color:#888">Voice Order Game</div></div>
<div class="mode-select">
<button class="btn-mode btn-super-easy" onclick="startGame('super_easy')"><i class="fa-solid fa-child"></i> SUPER EASY<span class="mode-desc">（激甘判定）</span></button>
<button class="btn-mode btn-easy" onclick="startGame('easy')"><i class="fa-solid fa-star"></i> EASY MODE<span class="mode-desc">（補正あり）</span></button>
<button class="btn-mode btn-normal" onclick="startGame('normal')"><i class="fa-solid fa-fire"></i> NORMAL MODE<span class="mode-desc">（補正なし）</span></button>
</div></div>
<div id="game-screen" class="app-wrapper">
<div class="header">
<button class="btn-back" onclick="returnToTitle()" title="タイトルへ戻る"><i class="fa-solid fa-house"></i></button>
<i class="fa-solid fa-mug-hot mr-2" style="color:#ff9a9e"></i> DRINK STAND <span id="mode-display" style="font-size:0.8rem;margin-left:10px;color:#999"></span>
</div>
<div class="stage">
<div id="lane0" class="lane">
<div class="customer-area"><div class="reward-pill" id="reward0">$30</div><div id="avatar0" class="customer-avatar"><i class="fa-solid fa-user"></i></div><button class="btn-replay" onclick="playModel(0)"><i class="fa-solid fa-volume-high"></i></button></div>
<div class="order-container" id="visuals0"></div><div id="stamp0" class="clear-stamp">PERFECT!</div><div id="earned0" class="earned-popup"></div>
<div class="action-area"><button id="micBtn0" class="btn-mic" onmousedown="startRecording(0,event)" onmouseup="stopRecording(0,event)" onmouseleave="stopRecording(0,event)" ontouchstart="startRecording(0,event)" ontouchend="stopRecording(0,event)"><i class="fa-solid fa-microphone-lines"></i> 押して喋る</button><button class="btn-next" onclick="refreshLane(0)"><i class="fa-solid fa-rotate"></i></button></div></div>
<div id="lane1" class="lane">
<div class="customer-area"><div class="reward-pill" id="reward1">$50</div><div id="avatar1" class="customer-avatar"><i class="fa-solid fa-user"></i></div><button class="btn-replay" onclick="playModel(1)"><i class="fa-solid fa-volume-high"></i></button></div>
<div class="order-container" id="visuals1"></div><div id="stamp1" class="clear-stamp">PERFECT!</div><div id="earned1" class="earned-popup"></div>
<div class="action-area"><button id="micBtn1" class="btn-mic" onmousedown="startRecording(1,event)" onmouseup="stopRecording(1,event)" onmouseleave="stopRecording(1,event)" ontouchstart="startRecording(1,event)" ontouchend="stopRecording(1,event)"><i class="fa-solid fa-microphone-lines"></i> 押して喋る</button><button class="btn-next" onclick="refreshLane(1)"><i class="fa-solid fa-rotate"></i></button></div></div>
</div><div class="footer"><div id="speechLog">ボタンを【押している間】だけ注文を聞き取ります</div></div></div>
<script>
const MENU=[{id:'oolong',type:'base',price:30,kanji:'烏龍茶',kana:'ウーロンチャ',image:'<img src="material/drink/drink_oolongtea.png">'},{id:'black',type:'base',price:30,kanji:'紅茶',kana:'ホンチャ',image:'<img src="material/drink/drink_blacktea.png">'},{id:'green',type:'base',price:30,kanji:'綠茶',kana:'リュチャ',image:'<img src="material/drink/drink_greentea.png">'},{id:'coffee',type:'base',price:40,kanji:'咖啡',kana:'カーフェイ',image:'<img src="material/drink/drink_coffee.png">'},{id:'fruit',type:'base',price:40,kanji:'水果茶',kana:'シュイグオチャ',image:'<img src="material/drink/drink_fruitstea.png">'},{id:'pearl',type:'topping',price:10,kanji:'珍珠',kana:'ゼンズー',image:'<img src="material/topping/top_boba.png">'},{id:'coco',type:'topping',price:10,kanji:'椰果',kana:'イェグオ',image:'<img src="material/topping/top_natadecoco.png">'},{id:'milk',type:'topping',price:10,kanji:'鮮奶',kana:'シェンナイ',image:'<img src="material/topping/top_milk.png">'},{id:'cheese',type:'topping',price:15,kanji:'奶蓋',kana:'ナイガイ',image:'<img src="material/topping/top_cheese.png">'},{id:'yakult',type:'topping',price:15,kanji:'多多',kana:'ドゥオドゥオ',image:'<img src="material/topping/top_yogurt.png">'},{id:'pudding',type:'topping',price:15,kanji:'布丁',kana:'ブディン',image:'<img src="material/topping/top_pudding.png">'},{id:'jelly',type:'topping',price:10,kanji:'仙草',kana:'シェンツァオ',image:'<img src="material/topping/top_grass.png">'},{id:'s0',type:'sugar',price:0,kanji:'無糖',kana:'ウータン',image:'<span class="text-lg font-bold text-gray-400">0%</span>'},{id:'s25',type:'sugar',price:0,kanji:'微糖',kana:'ウェイタン',image:'<span class="text-lg font-bold text-blue-400">25%</span>'},{id:'s70',type:'sugar',price:0,kanji:'少糖',kana:'シャオタン',image:'<span class="text-lg font-bold text-pink-400">70%</span>'},{id:'s50',type:'sugar',price:0,kanji:'半糖',kana:'バンタン',image:'<span class="text-lg font-bold text-yellow-400">50%</span>'},{id:'s100',type:'sugar',price:0,kanji:'正常糖',kana:'ジェンチャンタン',image:'<span class="text-lg font-bold text-red-500">100%</span>'},{id:'i0',type:'ice',price:0,kanji:'去冰',kana:'チュービン',image:'<i class="fa-solid fa-ban text-red-500"></i>'},{id:'i25',type:'ice',price:0,kanji:'微冰',kana:'ウェイビン',image:'<i class="fa-regular fa-snowflake text-blue-200"></i>'},{id:'i70',type:'ice',price:0,kanji:'少冰',kana:'シャオビン',image:'<i class="fa-regular fa-snowflake text-blue-300"></i>'},{id:'i100',type:'ice',price:0,kanji:'正常冰',kana:'ジェンチャンビン',image:'<i class="fa-regular fa-snowflake text-blue-500"></i>'}];
const CUSTOMERS=[{img:'material/customer/customer_obachan.png',icon:'fa-person-dress',color:'#e84393',bg:'#ffeaa7',desc:'おばちゃん'},{img:'material/customer/customer_driver.png',icon:'fa-helmet-safety',color:'#2d3436',bg:'#dfe6e9',desc:'ドライバー'},{img:'material/customer/customer_girl.png',icon:'fa-user-graduate',color:'#8e44ad',bg:'#f3e5f5',desc:'学生'},{img:'material/customer/customer_ojisan.png',icon:'fa-shirt',color:'#ff7675',bg:'#fab1a0',desc:'おじさん'}];
let currentMode='easy';
const MATCH_RULES={'烏龍茶':['烏龍','烏隆','汙龍','嗚龍'],'紅茶':['紅茶','宏茶','鴻茶','洪茶','紅'],'綠茶':['綠茶','綠','律','慮','率','呂'],'咖啡':['咖啡','咖','卡','喀'],'水果茶':['水果','水','誰','睡','稅'],'珍珠':['珍珠','珍','真','貞','甄','震','珠','豬','諸','朱'],'椰果':['椰果','椰','耶','爺','葉','業'],'鮮奶':['鮮奶','鮮','仙','先','纖','奶','乃','耐','奈'],'奶蓋':['奶蓋','奶','蓋','概','鈣','溉'],'多多':['多多','多','咄','朵','度'],'布丁':['布丁','布','不','步','部','丁','叮','盯'],'仙草':['仙草','仙','先','鮮','纖','草','曹','操','吵'],'無糖':['無糖','無','吳','吾','梧','糖','唐','堂','塘'],'微糖':['微糖','微','威','危','巍','圍'],'少糖':['少糖','少','燒','紹','哨','稍'],'半糖':['半糖','半','伴','辦','拌','絆'],'正常糖':['正常','正','政','證','常','長','償'],'去冰':['去冰','去','趣','娶','區','冰','兵','并','病'],'微冰':['微冰','微','威','危'],'少冰':['少冰','少','燒','紹'],'正常冰':['正常','正','常']};
const SIMPLIFIED_MAP={'红':'紅','绿':'綠','乌':'烏','龙':'龍','铁':'鐵','观':'觀','汤':'湯','奶':'奶','茶':'茶','珍':'珍','珠':'珠','半':'半','糖':'糖','去':'去','冰':'冰','杂':'茶','志':'去','制':'去'};
function normalizeText(t){if(currentMode==='easy'){let d=[];for(const[k,p]of Object.entries(MATCH_RULES)){if(p.some(pat=>t.includes(pat)))d.push(k)}if(d.length>0)return d.join(" ")}let s=t.replace(/\s+/g,'');let r='';for(let c of s){r+=SIMPLIFIED_MAP[c]||c}return r}
function generateRandomOrder(){const b=MENU.filter(i=>i.type==='base');const t=MENU.filter(i=>i.type==='topping');const s=MENU.filter(i=>i.type==='sugar');const c=MENU.filter(i=>i.type==='ice');const sb=b[Math.floor(Math.random()*b.length)];let it=[sb];let p=sb.price||30;const tc=Math.random()>0.4?1:0;const st=t.sort(()=>0.5-Math.random()).slice(0,tc);st.forEach(x=>{it.push(x);p+=(x.price||10)});if(Math.random()>0.4)it.push(s[Math.floor(Math.random()*s.length)]);if(Math.random()>0.4)it.push(c[Math.floor(Math.random()*c.length)]);const k=it.map(i=>i.kanji);return{items:it,text:k.join(" "),price:p,keywords:k}}
let orders=[null,null],cleared=[false,false],isListening=false,targetLane=0,finalTranscript="";
const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;const SpeechGrammarList=window.SpeechGrammarList||window.webkitSpeechGrammarList;let recognition;if(SpeechRecognition){recognition=new SpeechRecognition();recognition.lang='zh-TW';recognition.continuous=true;recognition.interimResults=true;if(SpeechGrammarList){const k=['烏龍茶','紅茶','綠茶','咖啡','水果茶','珍珠','椰果','鮮奶','奶蓋','多多','布丁','仙草','無糖','微糖','少糖','半糖','正常糖','去冰','微冰','少冰','正常冰'];const g='#JSGF V1.0; grammar menu; public <item> = '+k.join(' | ')+' ;';const l=new SpeechGrammarList();l.addFromString(g,1);recognition.grammars=l}recognition.onresult=(e)=>{let a="",p="";const r=e.results[e.resultIndex];for(let i=0;i<r.length;++i){a+=r[i].transcript+" ";if(i===0)p=r[i].transcript}finalTranscript=a;/*document.getElementById('speechLog').innerHTML='<span style="color:#aaa;">聞き取り中...</span>';*/};recognition.onend=()=>{isListening=false;checkOrder(targetLane)};recognition.onerror=(e)=>{isListening=false;const b=document.getElementById(`micBtn${targetLane}`);if(b){b.classList.remove('listening');b.innerHTML='<i class="fa-solid fa-microphone-lines"></i> 押して喋る'}document.getElementById('speechLog').innerText="エラー: もう一度押して話してください"}}
const synth=window.speechSynthesis;const bgm=document.getElementById('bgm');
function startRecording(l,e){if(e)e.preventDefault();if(!recognition){alert("ブラウザ未対応");return}if(isListening)return;try{targetLane=l;finalTranscript="";recognition.start();isListening=true;recognition.maxAlternatives=10;const b=document.getElementById(`micBtn${l}`);b.classList.add('listening');b.innerHTML='<i class="fa-solid fa-ear-listen"></i> 離して判定';document.getElementById('speechLog').innerHTML='聞き取り中...';/*document.getElementById('speechLog').style.color="#e67e22"*/}catch(z){console.error(z)}}
function stopRecording(l,e){if(e)e.preventDefault();if(!isListening||targetLane!==l)return;recognition.stop();const b=document.getElementById(`micBtn${l}`);b.classList.remove('listening');b.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> 判定中...'}
function checkOrder(l){const b=document.getElementById(`micBtn${l}`);if(!cleared[l])b.innerHTML='<i class="fa-solid fa-microphone-lines"></i> 押して喋る';if(!finalTranscript)return;if(currentMode==='super_easy'){/*document.getElementById('speechLog').innerHTML='認識: 「'+finalTranscript.substring(0,10)+'...」<br><span style="color:#2ecc71; font-weight:bold;">SUPER EASY: OK!</span>';*/markCleared(l);return}const c=normalizeText(finalTranscript);/*document.getElementById('speechLog').innerHTML='認識: 「'+finalTranscript.substring(0,10)+'...」<br><span style="color:#e67e22; font-weight:bold;">↓ 検出: '+c+'</span>';*/if(!cleared[l]&&orders[l]){const k=orders[l].keywords;let m=0;k.forEach(w=>{if(c.includes(w))m++});let r=Math.ceil(k.length*0.5);if(k.length>0&&m>=r){markCleared(l)}else{b.innerHTML='<i class="fa-solid fa-xmark"></i> 違うかも';setTimeout(()=>{if(!cleared[l]&&!isListening)b.innerHTML='<i class="fa-solid fa-microphone-lines"></i> 押して喋る'},1000)}}}
function markCleared(i){if(cleared[i])return;cleared[i]=true;const b=document.getElementById(`micBtn${i}`);b.classList.remove('listening');b.innerHTML='<i class="fa-solid fa-check"></i>';b.disabled=true;document.getElementById(`lane${i}`).classList.add('cleared');document.getElementById(`stamp${i}`).classList.add('stamp-animate');document.getElementById(`earned${i}`).innerText=`+$${orders[i].price}`;document.getElementById(`earned${i}`).classList.add('show');const u=new SpeechSynthesisUtterance("シェーシェー！");u.lang='zh-TW';synth.speak(u);setTimeout(()=>refreshLane(i),2000)}
function createCardHtml(l,x){let h='';if(x.length===0){h='<div class="card-text" style="color:#ddd;">ー</div>'}else{x.forEach(i=>{h+=`<div class="card-icon">${i.image}</div><div class="card-text">${i.kanji}</div>`})}return`<div class="order-card"><div class="card-label">${l}</div><div class="card-content">${h}</div></div>`}
function createAdjustCardHtml(s,i){const st="height:55px;display:flex;flex-direction:column;align-items:center;justify-content:center;";const sh=s.length>0?`<div style="${st}"><div style="font-size:35px;line-height:1;height:35px;display:flex;align-items:center;">${s[0].image}</div><div style="font-size:11px;font-weight:bold;color:#555;">${s[0].kanji}</div></div>`:`<div style="${st}"><div style="color:#ddd;font-weight:bold;font-size:18px;">ー</div></div>`;const ih=i.length>0?`<div style="${st}"><div style="font-size:30px;line-height:1;height:35px;display:flex;align-items:center;">${i[0].image}</div><div style="font-size:11px;font-weight:bold;color:#555;">${i[0].kanji}</div></div>`:`<div style="${st}"><div style="color:#ddd;font-weight:bold;font-size:18px;">ー</div></div>`;return`<div class="order-card"><div class="card-label">ADJUST</div><div class="card-content" style="justify-content:center;gap:0;"><div style="flex:1;width:100%;display:flex;align-items:center;justify-content:center;border-bottom:2px dashed #eee;">${sh}</div><div style="flex:1;width:100%;display:flex;align-items:center;justify-content:center;">${ih}</div></div></div>`}
function playModel(i){if(orders[i])speak(orders[i].rawText,0.85)}
function speak(t,r=1.0){if(synth.speaking)synth.cancel();const u=new SpeechSynthesisUtterance(t.replace(/\s+/g,'，'));u.lang='zh-TW';u.rate=r;synth.speak(u)}
function startGame(m){currentMode=m||'easy';let l='';if(recognition){recognition.lang='zh-TW';if(currentMode==='super_easy'){l='[SUPER EASY]'}else if(currentMode==='easy'){l='[EASY]'}else{l='[NORMAL]'}}document.getElementById('mode-display').innerText=l;const ts=document.getElementById('title-screen');const gs=document.getElementById('game-screen');if(bgm){bgm.volume=0.1;bgm.play().catch(e=>{})}ts.style.opacity='0';setTimeout(()=>{ts.style.display='none';gs.style.display='flex';init()},500)}
function returnToTitle(){const ts=document.getElementById('title-screen');const gs=document.getElementById('game-screen');if(recognition){isListening=false;try{recognition.stop()}catch(e){}}if(synth)synth.cancel();if(bgm){bgm.pause();bgm.currentTime=0}gs.style.display='none';ts.style.display='flex';setTimeout(()=>{ts.style.opacity='1'},10)}
function refreshLane(l){cleared[l]=false;document.getElementById(`lane${l}`).classList.remove('cleared');document.getElementById(`stamp${l}`).classList.remove('stamp-animate');document.getElementById(`earned${l}`).classList.remove('show');const b=document.getElementById(`micBtn${l}`);b.disabled=false;b.innerHTML='<i class="fa-solid fa-microphone-lines"></i> 押して喋る';b.classList.remove('listening');const c=CUSTOMERS[Math.floor(Math.random()*CUSTOMERS.length)];const n=generateRandomOrder();const bi=n.items.filter(i=>i.type==='base');const ti=n.items.filter(i=>i.type==='topping');const si=n.items.filter(i=>i.type==='sugar');const ii=n.items.filter(i=>i.type==='ice');orders[l]={rawText:n.text,price:n.price,keywords:n.keywords};let h='';h+=createCardHtml('BASE',bi);h+=createCardHtml('TOPPING',ti);h+=createAdjustCardHtml(si,ii);document.getElementById(`visuals${l}`).innerHTML=h;const a=document.getElementById(`avatar${l}`);if(c.img){a.innerHTML=`<img src="${c.img}" alt="Customer">`;a.style.backgroundColor="transparent";a.style.border="none"}else{a.innerHTML=`<i class="fa-solid ${c.icon}"></i>`;a.style.backgroundColor=c.bg;a.style.color=c.color;a.style.border="4px solid white"}a.classList.remove('customer-enter');void a.offsetWidth;a.classList.add('customer-enter');document.getElementById(`reward${l}`).innerText=`$${n.price}`;speak(orders[l].rawText)}
function init(){refreshLane(0);setTimeout(()=>refreshLane(1),1500)}
window.startGame=startGame;window.returnToTitle=returnToTitle;window.startRecording=startRecording;window.stopRecording=stopRecording;window.refreshLane=refreshLane;window.playModel=playModel;
</script>
</body>
</html>
